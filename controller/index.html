<!DOCTYPE html> 
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js" integrity="sha384-2huaZvOR9iDzHqslqwpR87isEmrfxqyWOF7hr7BY6KG0+hVKLoEXMPUJw3ynWuhO" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="./index.css">
    <title>control bom</title>
</head>

<html>
    <body>
        <h1>control panel</h1>
        <div class="outline-div">
            <h3>current question:</h3>
            <p id="current_question"></p>
        </div>
        <div class="outline-div">
            <h2>set current question</h2>
            <div id="questions">

            </div>
        </div>
        <div id="bottomRow">
            <p id="timer"></p>
        </div>
    </body>
</html>

<script>
    const queryString = window.location.search
    const urlParams = new URLSearchParams(queryString)
    var questionsArray = []

    console.log(urlParams.get("ip"))
    const socket = io(urlParams.get("ip"))

    socket.on("connect", () => {
        socket.emit("join", "controller")
    })

    socket.on("questions", (questions) => {
        const questionsDiv = document.getElementById("questions")
        questionsArray = questions
        questionsDiv.innerHTML = null
        
        questions.forEach(question => {
            let questionSelectButton = document.createElement("button")
            questionSelectButton.innerHTML = question.question
            questionSelectButton.setAttribute("onclick", `changeQuestion(${questions.indexOf(question)})`)

            questionsDiv.appendChild(questionSelectButton)
        })
    })

    function changeQuestion(questionIndex){
        document.getElementById("current_question").innerHTML = questionsArray[questionIndex].question
        socket.emit("changeQuestion", questionIndex)
    }
</script>